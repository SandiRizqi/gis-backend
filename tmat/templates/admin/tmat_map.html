<!-- shop/templates/admin/statistics.html -->

{% extends "admin/base_site.html" %}
{% block content %}
<!-- Include Leaflet CSS and JavaScript -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  /* Map container style */
  #map {
      height: 500px;
      width: 100%;
  }
</style>

<!-- Map container -->
<div id="map"></div>

<script>
  // Initialize Leaflet map
  var map = L.map('map').setView([51.505, -0.09], 13); // Set the initial view to a default location

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
  }).addTo(map);

  // Fetch and add markers
  function loadMapData(year) {
    $.ajax({
      url: `/api/map-data/${year}/`,
      type: "GET",
      dataType: "json",
      success: (jsonResponse) => {
        jsonResponse.locations.forEach(location => {
          L.marker([location.latitude, location.longitude])
            .addTo(map)
            .bindPopup(`<b>${location.code}</b><br>${location.afd_name}<br>${location.block_name}`);
        });
      },
      error: () => console.log("Failed to fetch map data!")
    });
  }

  $(document).ready(function() {
    // Load initial map data
    const initialYear = new Date().getFullYear(); // Default to current year
    //loadMapData(initialYear);
  });
</script>

{% endblock %}
